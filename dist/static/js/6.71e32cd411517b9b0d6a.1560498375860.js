webpackJsonp([6],{"2iAu":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("UnaJ"),a=r("ueeG"),s=r("P9l9"),l=r("VKC4"),i=r("rM4U"),n=function(e,t,r){t?Object(i.a)(t)?r():r(new Error("用户名不允许有空格")):r(new Error("请输入用户名"))},u=function(e,t,r){t?Object(i.a)(t)?r():r(new Error("真实姓名不允许有空格")):r(new Error("请输入真实姓名"))},c=function(e,t,r){t?Object(i.a)(t)?r():r(new Error("职位不允许有空格")):r(new Error("请输入职位"))},d=function(e,t,r){t?Object(i.c)(t)?r():r(new Error("请输入正确的11位手机号码")):r(new Error("请输入手机号码"))},m={name:"addUser",data:function(){return{requestProject:"gic-authcenter",topMenuData:[{id:"1",name:"用户管理",path:"/userManage"},{id:"2",name:"新增用户",path:""}],activeId:"2",options:[],ruleForm:{userName:"",userCode:"",realName:"",sex:1,departId:"",position:"",email:"",phone:"",otherPhone:"",userStyle:0,accountLocked:0,resetPassword:0},rules:{userName:[{required:!0,trigger:"blur",validator:n}],userCode:[{required:!0,trigger:"blur",message:"请输入工号"}],realName:[{required:!0,trigger:"blur",validator:u}],departId:[{required:!0,trigger:"change",message:"请输入工号"}],position:[{required:!0,trigger:"blur",validator:c}],phone:[{required:!0,trigger:"blur",validator:d}]},dateValue:"",datePickerBool:!1,saveDataBool:!0,otherPhoneBool:!1,contactRoleBool:!1,allUserList:[],selectedUserList:[],loginName:"",editBool:!1,tabId:""}},mounted:function(){this.$emit("getLinkType","authority"),this.init()},methods:{init:function(){this.tabId=this.$route.query.tabId,this.loginName=this.$route.query.loginName,this.getDepartList(),this.getNowDate(),this.getUserList(),this.topMenuData[0].path="/userManage?code=authz_manage&tabId="+this.tabId,this.loginName?(this.topMenuData[1].name="编辑用户",this.editBool=!0,this.getUserInfo()):(this.topMenuData[1].name="新增用户",this.editBool=!1)},getUserInfo:function(){var e=this,t={requestProject:this.requestProject};Object(s.b)("/gic-authcenter/user/"+this.loginName,t).then(function(t){var r=t.data;if(0==r.errorCode){var o=r.result;e.ruleForm.userName=o.loginName,e.ruleForm.userCode=o.employeeNumber,e.ruleForm.realName=o.realName,e.ruleForm.sex=o.sex,e.ruleForm.departId=o.departmentId,e.ruleForm.position=o.position,e.ruleForm.email=o.email,e.ruleForm.phone=o.userMobile,e.ruleForm.otherPhone=o.userMobileBak,e.ruleForm.userStyle=o.accountType,e.ruleForm.accountLocked=o.accountLocked;var a=o.selectedRoleList?o.selectedRoleList:[];e.selectedUserList=[],a.forEach(function(t,r){e.selectedUserList.push(t.id)}),1==e.ruleForm.userStyle&&(e.dateValue=Object(l.dateFormat)(o.accountExpiredDate,"YYYY-MM-DD hh:mm:ss"))}else e.$message.error(r.message)}).catch(function(e){console.log(e)})},getNowDate:function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,o=e.getDate(),a=e.getHours(),s=e.getMinutes(),l=e.getSeconds();r=r<10?"0"+r:r,o=o<10?"0"+o:o,a=a<10?"0"+a:a,s=s<10?"0"+s:s,l=l<10?"0"+l:l,this.dateValue=t+r+o+" "+a+":"+s+":"+l},getDepartList:function(){var e=this,t={requestProject:this.requestProject};Object(s.b)("/gic-authcenter/department",t).then(function(t){var r=t.data;0==r.errorCode?e.options=r.result?r.result:[]:e.$message.error(r.message)}).catch(function(e){console.log(e)})},getUserList:function(){var e=this,t={requestProject:this.requestProject,allList:!0};Object(s.b)("/gic-authcenter/role",t).then(function(t){var r=t.data;if(0==r.errorCode){var o=r.result?r.result:[];e.allUserList=[],o.forEach(function(t,r){e.allUserList.push({key:t.id,label:t.roleName})})}else e.$message.error(r.message)}).catch(function(e){console.log(e)})},toInputCode:function(e){for(var t=e.target.value,r=t.toString().length;r<6;)t="0"+t,r++;r>6&&(t=t.substring(t.length-6)),this.ruleForm.userCode=t},checkOtherPhone:function(e){if(e){/^1[3|4|5|6|7|8|9][0-9]\d{8}$/.test(e)?this.otherPhoneBool=!1:this.otherPhoneBool=!0}else this.otherPhoneBool=!1},changeMyDate:function(){this.dateValue?this.saveDataBool=!0:this.datePickerBool=!0},changeUserType:function(e){1!=e&&(this.saveDataBool=!0)},changeContactRole:function(){this.selectedUserList&&this.selectedUserList.length>0?this.saveDataBool=!0:this.contactRoleBool=!0},saveSubmit:function(e){var t=this;1!=this.ruleForm.userStyle||this.dateValue||(this.datePickerBool=!0,this.saveDataBool=!1),this.selectedUserList&&this.selectedUserList.length<1&&(this.contactRoleBool=!0,this.saveDataBool=!1);var r={loginName:this.ruleForm.userName,accountType:this.ruleForm.userStyle,accountExpiredTime:this.dateValue,realName:this.ruleForm.realName,sex:this.ruleForm.sex,userMobile:this.ruleForm.phone,userMobileBak:this.ruleForm.otherPhone,email:this.ruleForm.email,employeeNumber:this.ruleForm.userCode,departmentId:this.ruleForm.departId,position:this.ruleForm.position,accountLocked:this.ruleForm.accountLocked,roleIds:this.selectedUserList.join(","),resetPassword:1==this.ruleForm.resetPassword};this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;t.saveDataBool&&!t.otherPhoneBool&&(t.editBool?(delete r.loginName,delete r.accountType,delete r.accountExpiredTime,delete r.employeeNumber,Object(s.d)("/gic-authcenter/user/"+t.loginName,r).then(function(e){var r=e.data;0==r.errorCode?(t.$message.success("保存成功"),t.$router.push("/userManage?code=authz_manage&tabId="+t.tabId)):t.$message.error(r.message)}).catch(function(e){console.log(e)})):(delete r.resetPassword,Object(s.c)("/gic-authcenter/user",r).then(function(e){var r=e.data;0==r.errorCode?(t.$message.success("保存成功"),t.$router.push("/userManage?code=authz_manage&tabId="+t.tabId)):t.$message.error(r.message)}).catch(function(e){console.log(e)})))})}},components:{ywTopBreadcrumb:o.a,ywInput:a.a}},h={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"my-right-content"},[r("yw-top-breadcrumb",{attrs:{topMenuData:e.topMenuData,activeId:e.activeId}}),e._v(" "),r("div",{staticClass:"add-wrap"},[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"110px"}},[r("h2",{staticClass:"small-title"},[e._v("\n        基本信息"),r("el-popover",{attrs:{placement:"top",width:"190",trigger:"hover",content:"用户的原始密码为:用户名+123"}},[r("i",{staticClass:"iconfont tooltip-icon iconxinxixianshi",attrs:{slot:"reference"},slot:"reference"})])],1),e._v(" "),r("el-form-item",{staticClass:"input-w364",attrs:{label:"用户名",prop:"userName"}},[r("yw-input",{attrs:{disabled:e.editBool,byteType:0,maxlength:20,placeholder:"最多20字"},model:{value:e.ruleForm.userName,callback:function(t){e.$set(e.ruleForm,"userName",t)},expression:"ruleForm.userName"}})],1),e._v(" "),r("el-form-item",{staticClass:"input-w364",attrs:{label:"工号",prop:"userCode"}},[r("el-input",{attrs:{disabled:e.editBool,type:"number",placeholder:"6位数字，左边补0；如：000019"},on:{blur:function(t){return e.toInputCode(t)}},model:{value:e.ruleForm.userCode,callback:function(t){e.$set(e.ruleForm,"userCode",t)},expression:"ruleForm.userCode"}})],1),e._v(" "),r("el-form-item",{staticClass:"input-w364",attrs:{label:"真实姓名",prop:"realName"}},[r("yw-input",{attrs:{byteType:0,maxlength:20,placeholder:"最多20字"},model:{value:e.ruleForm.realName,callback:function(t){e.$set(e.ruleForm,"realName",t)},expression:"ruleForm.realName"}})],1),e._v(" "),r("el-form-item",{staticClass:"is-required",attrs:{label:"性别",prop:"sex"}},[r("el-radio-group",{model:{value:e.ruleForm.sex,callback:function(t){e.$set(e.ruleForm,"sex",t)},expression:"ruleForm.sex"}},[r("el-radio",{attrs:{label:1}},[e._v("男")]),e._v(" "),r("el-radio",{attrs:{label:0}},[e._v("女")])],1)],1),e._v(" "),r("el-form-item",{staticClass:"input-w364",attrs:{label:"部门名称",prop:"departId"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择部门"},model:{value:e.ruleForm.departId,callback:function(t){e.$set(e.ruleForm,"departId",t)},expression:"ruleForm.departId"}},e._l(e.options,function(e){return r("el-option",{key:e.id,attrs:{label:e.departmentName,value:e.id}})}),1)],1),e._v(" "),r("el-form-item",{staticClass:"input-w364",attrs:{label:"职位",prop:"position"}},[r("yw-input",{attrs:{byteType:0,maxlength:20,placeholder:"最多20字"},model:{value:e.ruleForm.position,callback:function(t){e.$set(e.ruleForm,"position",t)},expression:"ruleForm.position"}})],1),e._v(" "),r("el-form-item",{staticClass:"input-w364",attrs:{label:"邮箱"}},[r("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.ruleForm.email,callback:function(t){e.$set(e.ruleForm,"email",t)},expression:"ruleForm.email"}})],1),e._v(" "),r("el-form-item",{staticClass:"input-w364",attrs:{label:"手机号码",prop:"phone"}},[r("el-input",{attrs:{type:"number",placeholder:"请输入内容"},model:{value:e.ruleForm.phone,callback:function(t){e.$set(e.ruleForm,"phone",t)},expression:"ruleForm.phone"}})],1),e._v(" "),r("el-form-item",{staticClass:"input-w364",class:{"is-error":e.otherPhoneBool},attrs:{label:"备用联系人",prop:"otherPhone"}},[r("el-input",{attrs:{type:"number",placeholder:"请输入内容"},on:{blur:function(t){return e.checkOtherPhone(e.ruleForm.otherPhone)}},model:{value:e.ruleForm.otherPhone,callback:function(t){e.$set(e.ruleForm,"otherPhone",t)},expression:"ruleForm.otherPhone"}}),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.otherPhoneBool,expression:"otherPhoneBool"}],staticClass:"el-form-item__error"},[e._v("\n          请输入正确的11位手机号码\n        ")])],1),e._v(" "),r("el-form-item",{staticClass:"is-required user-type-wrap",attrs:{label:"用户类型",prop:"userStyle"}},[r("el-radio-group",{attrs:{disabled:e.editBool},on:{change:e.changeUserType},model:{value:e.ruleForm.userStyle,callback:function(t){e.$set(e.ruleForm,"userStyle",t)},expression:"ruleForm.userStyle"}},[r("el-radio",{attrs:{label:0}},[e._v("内部")]),e._v(" "),r("el-radio",{attrs:{label:1}},[e._v("临时"),r("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:1==e.ruleForm.userStyle,expression:"ruleForm.userStyle == 1"}],staticClass:"my-date-picker",attrs:{disabled:e.editBool,"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择失效日期"},on:{change:e.changeMyDate},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}})],1),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("其他")])],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:1==e.ruleForm.userStyle&&e.datePickerBool&&!e.dateValue,expression:"ruleForm.userStyle == 1 && datePickerBool && !dateValue"}],staticClass:"date-picker-error el-form-item__error"},[e._v("请选择失效时间")])],1),e._v(" "),r("el-form-item",{staticClass:"is-required",attrs:{label:"是否冻结",prop:"accountLocked"}},[r("el-radio-group",{model:{value:e.ruleForm.accountLocked,callback:function(t){e.$set(e.ruleForm,"accountLocked",t)},expression:"ruleForm.accountLocked"}},[r("el-radio",{attrs:{label:0}},[e._v("否")]),e._v(" "),r("el-radio",{attrs:{label:1}},[e._v("是")])],1)],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.editBool,expression:"editBool"}],staticClass:"is-required reset-paw",attrs:{label:"是否重置密码",prop:"resetPassword"}},[r("el-radio-group",{model:{value:e.ruleForm.resetPassword,callback:function(t){e.$set(e.ruleForm,"resetPassword",t)},expression:"ruleForm.resetPassword"}},[r("el-radio",{attrs:{label:0}},[e._v("否")]),e._v(" "),r("el-radio",{attrs:{label:1}},[e._v("是"),r("el-popover",{attrs:{placement:"top",width:"50",trigger:"hover",content:"重置为原始密码"}},[r("i",{staticClass:"iconfont tooltip-icon iconxinxixianshi",attrs:{slot:"reference"},slot:"reference"})])],1)],1)],1),e._v(" "),r("h2",{staticClass:"small-title"},[e._v("用户角色")]),e._v(" "),r("el-form-item",{staticClass:"is-required my-transfer-wrap",attrs:{label:"关联角色"}},[r("el-transfer",{attrs:{data:e.allUserList,titles:["角色列表","已添加角色"],"button-texts":["移除","转入"]},on:{change:e.changeContactRole},model:{value:e.selectedUserList,callback:function(t){e.selectedUserList=t},expression:"selectedUserList"}}),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.contactRoleBool&&e.selectedUserList.length<1,expression:"contactRoleBool && selectedUserList.length < 1"}],staticClass:"el-form-item__error"},[e._v("请选择关联角色")])],1),e._v(" "),r("el-form-item",{staticStyle:{padding:"20px 0"}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.saveSubmit("ruleForm")}}},[e._v("保存")])],1)],1)],1)],1)},staticRenderFns:[]};var p=r("C7Lr")(m,h,!1,function(e){r("jaTn")},"data-v-30b6b80e",null);t.default=p.exports},"5T8U":function(e,t){},UnaJ:function(e,t,r){"use strict";var o={name:"yw-top-breadcrumb",props:{topMenuData:{type:Array,default:function(){return[]}},activeId:{type:[String,Number],default:function(){return""}}},data:function(){return{projectName:"",topData:[]}},methods:{changeRoute:function(e){e&&this.$router.push(e)},returnBack:function(){this.$router.push("appcenter")}},watch:{topMenuData:function(e,t){this.topData=e}},mounted:function(){this.topData=this.topMenuData}},a={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-detail-top"},[r("div",{staticClass:"el-tabs__header is-top"},[r("div",{staticClass:"el-tabs__nav-wrap is-top"},[r("div",{staticClass:"el-tabs__nav-scroll"},[r("ul",e._l(e.topData,function(t,o){return r("li",{key:o,class:["top-cell",t.id==e.activeId?"cell-active":""]},[r("div",{staticClass:"top-name",on:{click:function(r){return e.changeRoute(t.path)}}},[e._v(e._s(t.name))]),e._v(" "),e.topData.length>1&&o!=e.topData.length-1?r("i",{staticClass:"el-icon-arrow-right p-lr-11"}):e._e()])}),0)])])])])},staticRenderFns:[]};var s=r("C7Lr")(o,a,!1,function(e){r("5T8U")},"data-v-210426f2",null);t.a=s.exports},jaTn:function(e,t){}});
//# sourceMappingURL=6.71e32cd411517b9b0d6a.1560498375860.js.map