webpackJsonp([10],{"Z2+w":function(e,t){},kP3l:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("ueeG"),n=o("P9l9"),a=o("rM4U"),i=function(e,t,o){t?Object(a.a)(t)?o():o(new Error("分类目录名称不允许有空格")):o(new Error("请输入分类目录名称"))},s=function(e,t,o){t?Object(a.b)(t)?o():o(new Error("分类目录编码只能由英文、下划线、数字组成")):o(new Error("请输入分类目录编码"))},l={name:"categoryList",data:function(){return{requestProject:"gic-bizdict",tableData:[],currentPage:1,pageSize:10,totalCount:0,menuTitle:"创建字典分类",dialogVisible:!1,options:[],editCodeBool:!1,menuForm:{name:"",menuCode:"",parentCode:""},rules:{name:[{required:!0,trigger:"blur",validator:i}],menuCode:[{required:!0,trigger:"blur",validator:s}]},loading:!1,menuType:"",menuId:"",searchInput:"",dialogVisibleLook:!1,lookData:[],defaultProps:{children:"nodeChildren",label:"categoryName"},currentTreeId:""}},mounted:function(){this.init()},methods:{init:function(){var e=this.$route.query.tabId;this.$emit("showTab",e),this.getDictionaryList()},getDictionaryList:function(){var e=this;this.loading=!0;var t={requestProject:this.requestProject,currentPage:this.currentPage,pageSize:this.pageSize,search:this.searchInput};Object(n.b)("/gic-bizdict/category/root",t).then(function(t){var o=t.data.result;if(e.loading=!1,0==o.errorCode){var r=o.result?o.result:[];""!=e.searchInput?e.tableData=r:(e.tableData=e.addMenuPara(r),e.tableData.forEach(function(e){e.firstLevel=!0})),e.totalCount=o.totalCount}else e.$message.error(o.message)}).catch(function(e){console.log(e)})},loadNextList:function(e,t,o){var r=this,a={requestProject:this.requestProject,code:e.code},i=[];Object(n.b)("/gic-bizdict/category/next",a).then(function(e){var t=e.data;if(0==t.errorCode){var n=t.result?t.result:[];i=r.addMenuPara(n),o(i)}else r.$message.error(t.message)}).catch(function(e){console.log(e)})},searchList:function(){this.currentPage=1,this.getDictionaryList()},handleCurrentChange:function(e){this.currentPage=e,this.getDictionaryList()},handleSizeChange:function(e){this.pageSize=e,this.getDictionaryList()},addMenuPara:function(e){return e.forEach(function(t){t.numBool=!0,t.total=e.length,t.hasChildren=t.nextCount>0,t.oldSort=t.indexSort}),e},changeNum:function(e){e.numBool=!1},blurNumInput:function(e){e.numBool=!0,e.indexSort>e.total||e.indexSort<1?e.indexSort=e.oldSort:this.sortMenu(e)},sortMenu:function(e){var t=this,o={requestProject:this.requestProject,sortCategory:!0,sort:e.indexSort};Object(n.d)("/gic-bizdict/category/"+e.code,o).then(function(e){var o=e.data;0==o.errorCode?(t.getDictionaryList(),t.$message.success("排序成功")):t.$message.error(o.message)}).catch(function(e){console.log(e)})},keyupInput:function(e){(e.indexSort>e.total||e.indexSort<1)&&(e.indexSort="")},lookDictionay:function(e){var t=this;this.dialogVisibleLook=!0;var o={requestProject:this.requestProject,code:e.code};Object(n.b)("/gic-bizdict/category/tree",o).then(function(o){var r=o.data;t.loading=!1,0==r.errorCode?(t.lookData=r.result?r.result:[],t.currentTreeId=e.id,t.$nextTick(function(e){t.$refs.lookTree.setCurrentKey(t.currentTreeId)})):t.$message.error(r.message)}).catch(function(e){console.log(e)})},handleNodeClick:function(){this.$refs.lookTree.setCurrentKey(this.currentTreeId)},delMenu:function(e,t,o){var r=this;this.$confirm("是否要删除选中的分类?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e={requestProject:r.requestProject};Object(n.a)("/gic-bizdict/category/"+t.code,e).then(function(e){var t=e.data;0==t.errorCode?(r.getDictionaryList(),r.$message.success("删除成功")):r.$message.error(t.message)})}).catch(function(e){console.log(e)})},editMenu:function(e){this.menuTitle="编辑字典分类",this.menuType="edit",this.dialogVisible=!0,this.editCodeBool=!0,this.menuId=e.id,this.menuForm={name:e.categoryName,menuCode:e.code,parentCode:e.parentCode}},toCreateMenu:function(e,t){this.dialogVisible=!0,this.editCodeBool=!1,this.menuId="",this.menuType="add",this.$refs.menuForm&&this.$refs.menuForm.resetFields(),"main"==e?(this.menuTitle="创建字典分类",this.menuForm.parentCode=""):"child"==e&&(this.menuForm.parentCode=t.code,this.menuTitle="创建子节点"),this.menuForm.name="",this.menuForm.menuCode=""},cancelCreate:function(){this.dialogVisible=!1,this.$refs.menuForm.clearValidate()},sureCreate:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var o={requestProject:t.requestProject,categoryName:t.menuForm.name,code:t.menuForm.menuCode,parentCode:t.menuForm.parentCode};"add"==t.menuType?Object(n.c)("/gic-bizdict/category",o).then(function(e){var o=e.data;0==o.errorCode?(t.dialogVisible=!1,t.searchInput="",t.currentPage=1,t.getDictionaryList(),t.$message.success("保存成功")):t.$message.error(o.message)}).catch(function(e){console.log(e)}):"edit"==t.menuType&&Object(n.d)("/gic-bizdict/category/"+t.menuForm.menuCode,o).then(function(e){var o=e.data;0==o.errorCode?(t.dialogVisible=!1,t.getDictionaryList(),t.$message.success("保存成功")):t.$message.error(o.message)}).catch(function(e){console.log(e)})})}},components:{ywInput:r.a}},c={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"my-right-content"},[r("div",{staticClass:"create-btn clearfix"},[r("el-input",{staticClass:"search-input",attrs:{clearable:"",placeholder:"请输入目录名称、目录编码","prefix-icon":"el-icon-search"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchList(t)}},model:{value:e.searchInput,callback:function(t){e.searchInput=t},expression:"searchInput"}}),e._v(" "),r("el-button",{staticClass:"fr",attrs:{type:"primary"},on:{click:function(t){return e.toCreateMenu("main")}}},[e._v("创建字典分类")])],1),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table-no-line-wrap my-table-wrap",attrs:{data:e.tableData,"row-key":"id",lazy:"",load:e.loadNextList}},[r("el-table-column",{attrs:{prop:"categoryName",label:"分类目录名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.indexSort>-1?r("div",{staticClass:"menu-name-wrap",class:{"my-name-wrap":t.row.firstLevel,"my-no-child":t.row.nextCount>0}},[t.row.numBool?r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"排序",placement:"top"}},[r("span",{on:{click:function(o){return e.changeNum(t.row)}}},[e._v(e._s(t.row.indexSort))])]):r("el-input",{directives:[{name:"focus",rawName:"v-focus",value:!t.row.numBool,expression:"!scoped.row.numBool"}],staticClass:"num-input-wrap",attrs:{type:"number"},on:{blur:function(o){return e.blurNumInput(t.row)}},nativeOn:{keyup:function(o){return e.keyupInput(t.row)}},model:{value:t.row.indexSort,callback:function(o){e.$set(t.row,"indexSort","string"==typeof o?o.trim():o)},expression:"scoped.row.indexSort"}}),e._v("\n          "+e._s(t.row.categoryName)+"\n        ")],1):r("span",[e._v(e._s(t.row.categoryName))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"code",label:"分类目录编码"}}),e._v(" "),r("el-table-column",{attrs:{prop:"parentCode",label:"父级编码","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.parentCode?t.row.parentCode:"--"))]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"opr",label:"操作",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.indexSort<0,expression:"scoped.row.indexSort < 0"}],attrs:{type:"text"},on:{click:function(o){return e.lookDictionay(t.row)}}},[e._v("查看")]),e._v(" "),r("el-button",{attrs:{type:"text"},on:{click:function(o){return e.editMenu(t.row)}}},[e._v("编辑")]),e._v(" "),r("el-button",{attrs:{type:"text"},on:{click:function(o){return e.toCreateMenu("child",t.row)}}},[e._v("创建子节点")]),e._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.nextCount<1,expression:"scoped.row.nextCount < 1"}],attrs:{type:"text"},on:{click:function(o){return e.delMenu(t,t.row,t.$index)}}},[e._v("删除")])]}}])}),e._v(" "),r("template",{slot:"empty"},[r("div",{staticClass:"no-data-wrap"},[r("div",{staticClass:"no-data-icon"},[r("img",{attrs:{src:o("8Td+"),alt:""}})]),e._v(" "),r("p",[e._v("暂无数据")])])])],2),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.totalCount>0,expression:"totalCount > 0"}],staticClass:"pagination"},[r("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next",total:e.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),r("el-dialog",{attrs:{title:e.menuTitle,visible:e.dialogVisible,width:"425px","before-close":e.cancelCreate},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{ref:"menuForm",attrs:{model:e.menuForm,rules:e.rules,"label-width":"110px"}},[r("el-form-item",{attrs:{label:"分类目录名称",prop:"name"}},[r("yw-input",{attrs:{byteType:0,maxlength:20,placeholder:"最多20个字"},model:{value:e.menuForm.name,callback:function(t){e.$set(e.menuForm,"name",t)},expression:"menuForm.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"分类目录编码",prop:"menuCode"}},[r("yw-input",{attrs:{disabled:e.editCodeBool,byteType:0,maxlength:32,placeholder:"英文、下划线、数字组成，最多32字"},model:{value:e.menuForm.menuCode,callback:function(t){e.$set(e.menuForm,"menuCode",t)},expression:"menuForm.menuCode"}})],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.menuForm.parentCode,expression:"menuForm.parentCode"}],attrs:{label:"父级编码"}},[r("el-input",{attrs:{disabled:""},model:{value:e.menuForm.parentCode,callback:function(t){e.$set(e.menuForm,"parentCode",t)},expression:"menuForm.parentCode"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.cancelCreate}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.sureCreate("menuForm")}}},[e._v("确 定")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"look-tree-dialog-wrap",attrs:{title:"查看",visible:e.dialogVisibleLook,width:"450px"},on:{"update:visible":function(t){e.dialogVisibleLook=t}}},[r("el-tree",{ref:"lookTree",staticClass:"look-tree-wrap",attrs:{data:e.lookData,props:e.defaultProps,"default-expand-all":"","node-key":"id","highlight-current":"","expand-on-click-node":!1},on:{"node-click":e.handleNodeClick}}),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisibleLook=!1}}},[e._v("知道了")])],1)],1)],1)},staticRenderFns:[]};var u=o("C7Lr")(l,c,!1,function(e){o("Z2+w")},"data-v-b06dae2a",null);t.default=u.exports}});
//# sourceMappingURL=10.db252951156ebfa60ffe.1560498375860.js.map